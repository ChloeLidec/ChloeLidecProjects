{% extends 'basegen.html' %}
{% block styles %}
{% load static %}
{% endblock %}
{% block center %}
{% if user.is_authenticated %}
<div class="d-flex justify-content-evenly m-3">
    <div class="d-flex flex-column w-25 m-3">
        <form method="POST" action="{% url 'Sondages:resultats_sond' %}">
            {% csrf_token %}
            <div class="d-flex justify-content w-100">
                <h2>Filtres</h2>
                <button class="btn" id="dep_fil" type="button" onclick="plie_deplie_semaines()">
                    <svg id="flecg" xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor"
                        class="bi bi-arrow-down-circle-fill m-1" viewBox="0 0 32 32">
                        <path
                            d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v5.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V4.5z" />
                    </svg></button>
            </div>
            <div id="groupe_filtre" class="w-100">
                <select class="form-select" name="semaine" id="selec-sem" class="m-3 w-75">
                    {% for semaine in semaines %}
                        {% if semaine.id_semaine == semaine_select %}
                            <option value="{{ semaine.id_semaine }}" selected>Sem {{ semaine.id_semaine }} {{ semaine.date_debut }}</option>

                        {% else %}
                            <option value="{{ semaine.id_semaine }}">Sem {{ semaine.id_semaine }} {{ semaine.date_debut }}</option>
                        
                        {% endif %}
                    {% endfor %}
                </select>
                <div class="d-flex justify-content w-100">
                    <h3>Groupes</h3>
                    <button class="btn" id="dep_grp" type="button" onclick="plie_deplie_filtres()">
                        <svg id="fleci" xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor"
                            class="bi bi-arrow-down-circle-fill m-1" viewBox="0 0 32 32">
                            <path
                                d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v5.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V4.5z" />
                        </svg></button>
                </div>
                <div id="grps_filtres" class="d-flex flex-column m-3 p-2">
                    {% for groupe in groupes %}
                    <div class="m-2">
                        {% if groupe in groupe_select %}
                        <input type="checkbox" id="{{ groupe }}" name="groupe" value="{{ groupe }}" class="form-check-input" checked>
                        {% else %}
                        <input type="checkbox" id="{{ groupe }}" name="groupe" value="{{ groupe }}" class="form-check-input">
                        {% endif %}
                        <label for="{{ groupe }}" class="form-check-label">{{ groupe }}</label>
                    </div>
                    {% endfor %}
                </div>
                <input class="btn btn-primary" id="liaison_bd" class="btn_valide" value="Valider" type="submit"></input>
            </div>
        </form>
    </div>
    <div class="d-flex flex-column w-75 table-responsive m-4" style="height: 75vh;">
        <table class="table table-hover align-middle">
            <thead style="position: sticky;top: 0px;background-color: white;">
                <tr>
                    <th colspan="5" class="table-dark text-center align-middle">Sondage</th>
                </tr>
                <tr>
                    <th class="text-center align-middle col-md-1">Etudiant</th>
                    <th class="text-center align-middle col-md-1">Groupe</th>
                    <th class="text-center align-middle col-md-1">Volontaire</th>
                    <th class="text-center align-middle col-md-1">Matiere Voulue</th>
                    <th class="text-center align-middle col-md-1">Commentaire</th>
                </tr>
            </thead>
            <tbody>
                {% for eleve,volontaire,matiere,commentaire in resultats %}
                <tr>
                    <th class="text-center col-md-1" scope="row"><a
                            href="{% url 'Suivi:suivi_etudiant' eleve.num_etu %}" target="_blank"> {{ eleve.nom }}
                            {{eleve.prenom}}</a>
                    </th>
                    <td class="text-center col-md-1" id="eleve_groupe">{{ eleve.groupe }}</td>
                    <td class="text-center col-md-1" id="eleve_volontaire">{{ volontaire }}</td>
                    <td class="text-center col-md-1" id="eleve_matiere">{{ matiere }}</td>
                    <td class="text-center col-md-1" id="eleve_commentaire">{{ commentaire }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% else %}
<!-- on affiche la page de connexion /login -->
{% include 'connexion.html' %}
{% endif %}
{% endblock %}
{% block scripts %}
<script src="{% static 'js/plie_dep.js' %}"></script>
<script src="{% static 'js/res_sond.js' %}"></script>
{% endblock %}